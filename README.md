## RC_yacht — ESP32 Wi‑Fi サーボコントローラ付き RC ヨット計画

3D プリンターで船体とセールを作り、ESP32 でラジコン風のヨットを動かすプロジェクト。リポジトリには以下が入ってる。

- `CAD_Data/` 3D データ一式（船体やパーツ）
- `Program_Data/` PlatformIO（ESP32/Arduino）プロジェクト。Wi‑Fi アクセスポイント＋ Web サーバでサーボを操作する実装

この README は、とくに `Program_Data/src/main.cpp` の実装をベースに、配線・ビルド・使い方をまとめた。

## 目的・動機（教育教材としての RC ヨット）

### 1. 動機

現在、高等学校において必履修科目となっている「情報 Ⅰ」では、ネットワークの基礎や Python、JavaScript などを用いたプログラミング学習が主な教育内容となっている。一方で、これらのソフトウェアを動作させる基盤であるハードウェアに焦点を当てた授業は多くなく、ハードウェア教育は十分に行われているとは言い難い。

ハードウェアを通じた学習は、将来ハードウェアエンジニアを志す生徒だけでなく、ソフトウェアエンジニアにとっても、実行環境や物理的制約を理解する上で重要である。ソフトウェアとハードウェアの関係を実体験を通して学ぶことは、情報分野全体の理解を深めることにつながる。

そこで本研究では、RC ヨットを教材として用い、マイコン制御、基板製作、機構設計を組み合わせた教育教材の開発を目的とする。実際に動作する機体を自ら設計・製作・制御する体験を通して、実践的なハードウェアの知識および技術を習得できる教材の実現を目指す。

### 2. 目標物

#### 2.1 全体的な構想

本教材は、小学生（低学年・高学年）、中学生、高校生といった幅広い年齢層を対象とし、年齢に応じて組み立て手順や使用部品、作業内容の難易度を段階的に変化させる構成とする。

また、部品の選択やデザイン変更によるカスタマイズを可能とし、生徒それぞれが独自の機体を製作できるようにすることで、創意工夫や価値創造を促す点で、Society 5.0 において求められる能力の育成にも寄与すると考えられる。1）

#### 2.1 ハードウェア面

##### 2.1.1 ボディ

ボディの製作方法として、複数のアプローチを検討している。 1 つ目は、3D プリンターを用いて PLA や PETG で直接造形する方法である。PLA は安価で扱いやすく、PETG は透明造形が可能であるため、内部構造を可視化する教材としての活用も期待できる。また、ボディ表面には装飾用の穴を設け、外観のカスタマイズを可能とする。

2 つ目は、3D プリンターで ABS など耐熱性の高いフィラメントを用いて製作した型にエポキシ樹脂を流し込んで成形する方法であり、複数の型を用意することで形状の選択を可能とする。

3 つ目は、3D プリンターで骨組みを造形し、エポキシパテで外形を形成する方法でありこの方法では、生徒が形状をある程度自由に変更できるため、創造性をより重視した教材として活用できると考えている。

##### 2.1.2 セール・ラダー

セールおよびラダーの制御には、安価で入手しやすい SG90 サーボモータを使用する。

セールは、マストおよびブームを竹串または 3D プリンターで製作し、布や薄いプラスチックシートを取り付ける構成とする。竹串を用いる場合は加工精度や固定強度に課題があり組み立て難易度が高くなるが、破損時に市販材料で容易に修理できる利点がある。一方、3D プリンター製の場合は組み立てが容易であるが、代替が難しいという課題があるため、対象年齢に応じた使い分けや、破損しにくい構造の採用が必要である。セール本体には、布や薄いプラスチックシートなどの描画可能な素材を使用し、生徒が自由に模様やデザインを施せるようにすることで、ものづくりとしての楽しさや表現活動の要素も取り入れる。

ラダー（舵）については、3D プリンターによる造形を想定している。

##### 2.1.3 マイコン・基板

マイコンには、Wi-Fi 機能を備え、安価で情報が豊富な ESP32 を採用する。ESP32 は 5V 出力が 1 系統のみであるため、複数のサーボや 6 軸 IMU(LSM6DSV16X)接続するための回路を含む基板を別途設計・製作する。また、基板には制御回路とは独立した領域を設け、ピンヘッダや抵抗のはんだ付け練習ができる構造とする。

基板の組み立てについては、小学生には完成品を提供し、中学生・高校生には自ら部品を実装させる段階的な構成とする。

#### 2.2 ソフトウェア面

ESP32 はアクセスポイント兼 HTTP サーバとして動作させ、Web ブラウザからセールおよびラダーを操作できる仕組みを構築する。2)

プログラミング環境は、小学生および中学生には Scratch のようなビジュアルプログラミング環境を使用し、高校生には Arduino IDE を用いた C++ プログラミングを採用する。

### 3. 現在の進捗

ボディは PLA を用いて 3D プリンターで造形した。初期設計では水との接触面積が小さく、転倒しやすいという課題が確認されたため、現在は接水面積を増やす設計へと改良しているが、依然として安定性に課題が残っている。

セール部分については、当初竹串を用いていたが固定が困難であったため、等間隔に穴を設けたマストおよびブームを 3D プリンターで造形し、薄いプラスチックシートをセールとして取り付ける構造に変更した。

セールおよびラダーは、ESP32 に直接接続したサーボモータによって制御している。制御ソフトウェアは、ESP32 をアクセスポイント兼 HTTP サーバとして動作させ、ブラウザから特定の IP アドレスにアクセスすることで操作可能な Web ページを表示する構成とした。実装には GitHub Copilot を活用した。

### 4. これからやること

現在の試作機は横転しやすいという課題を抱えているため、6 軸 IMU を用いて機体の姿勢を検知し、転倒しそうな方向とは反対側へセールを移動させる制御処理を実装する予定である。これにより、ソフトウェア制御による安定性向上を図る。また、ボディ形状についても再検討を行い、物理的に転倒しにくい構造を模索する。

低年齢層の生徒でも容易に組み立てられるよう、ネジを使用せず、ツメ構造のみで機体が完成する設計を目指す。加えて、2.2.1 で示した複数のボディ製作方法を実際に試し、教育効果や組み立てやすさの観点から比較・検討を行う。

現在はラダーをサーボに直接取り付けているが、ギアの噛み合わせが不十分であるため、今後はサーボホーンを用いた適切な機構設計を行う。

ソフトウェア面では、Arduino 環境上でビジュアルプログラミングが可能となる仕組みの導入を検討する。

また、万が一横転した場合でも内部に水が浸入しないよう、防水対策を施す必要がある。

さらに、電源部については現時点で未実装であるため、単 3 電池などで動作可能な電池ボックスの設計を行う。

生徒が多少乱暴に扱っても破損しにくい、教育現場に適した堅牢な構造の実現も重要な課題である。

将来的には、複数台での対戦要素の導入についても検討したい。

## できること

- ESP32 がスタンドアロンの Wi‑Fi アクセスポイント（AP）になる（デフォルト SSID: `WIFI` ／パスワードなし）
- ブラウザで `http://192.168.4.1` にアクセスすると、モダン UI のスライダーでサーボ角度を 0–180° で操作
- クイックボタン（左端/中央/右端）で即移動
- REST 風エンドポイントからも操作可能（後述）
- 起動時にサーボ自己テスト（0°→90°→180°）

## ハード構成と配線

必須部品（例）

- ESP32 DevKit（PlatformIO の `esp32dev` ボード想定）
- マイクロサーボ（SG90 等）
- 5V サーボ用電源（推奨：USB 5V or 2S バッテリ＋レギュレータ）
- 共通 GND 配線

配線（デフォルト設定）

- サーボ信号線 → ESP32 GPIO 18（`servoPin = 18`）
- サーボ電源（赤） → 外部 5V（ESP32 の 5V ピンでも動くことはあるが非推奨）
- サーボ GND（茶/黒） → 外部電源の GND
- ESP32 GND → 外部電源の GND（サーボ電源と必ず共通化）

注意点
ｓ

- サーボは瞬間的に大電流を食う。ESP32 の 3.3V からは絶対に給電しない。外部 5V を使う。
- ジッターやリセットが出るときは、外部電源を強化し、GND 共通を確認。

## ソフト/ビルド環境（PlatformIO）

`Program_Data/platformio.ini` 抜粋：

```ini
[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino
lib_deps = madhephaestus/ESP32Servo@^3.0.5
monitor_speed = 115200
# 注意: 現状ファイルには "jupload_speed" と書かれている
# 正しくは ↓ のキー名（必要なら修正して使う）
# upload_speed = 115200
board_build.flash_mode = dio
board_build.f_flash = 40000000L
```

依存ライブラリ

- ESP32Servo（PWM/Servo 制御）

書き込み手順（VS Code + PlatformIO）

1. VS Code で `Program_Data/` を PlatformIO プロジェクトとして開く
2. ボードを PC に接続し、COM ポートを確認
3. 「PlatformIO: Upload」で書き込み
4. 「PlatformIO: Monitor」でシリアルを 115200bps で開く

## 使い方（Wi‑Fi と Web UI）

初期設定（`src/main.cpp` より）

- AP SSID: `WIFI`
- パスワード: なし（オープン）
- AP IP: `192.168.4.1`
- Web サーバ: ポート 80

手順

1. 書き込み後、ESP32 が再起動。シリアルに起動ログが出る
2. スマホ/PC の Wi‑Fi で SSID `WIFI` に接続（パスワード不要）
3. ブラウザで `http://192.168.4.1` を開く
4. 画面のスライダーやボタンでサーボを操作（初期角度は 90°）

UI からの操作に加えて、以下の HTTP エンドポイントでも制御できる：

- `GET /servo?angle=<0..180>` … 指定角へ移動（プレーンテキストで現在角度を返す）
- `GET /left` … 現在値から −30°
- `GET /right` … 現在値から +30°
- `GET /center` … 90° に移動

## コードの主な設定ポイント

`Program_Data/src/main.cpp` より：

- サーボピン: `const int servoPin = 18;`
- 初期角度: `int servoPosition = 90;`
- 角度範囲: 0–180°（`constrain` で保護）
- 起動時自己テスト: 0→90→180→ 初期角
- AP 設定: `WiFi.softAPConfig(local_IP, gateway, subnet); WiFi.softAP(ap_ssid);`

パスワードを付けたいなら（例）：

```cpp
const char* ap_ssid = "MyYacht";
const char* ap_password = "pass1234"; // 8文字以上
...
WiFi.softAPConfig(local_IP, gateway, subnet);
WiFi.softAP(ap_ssid, ap_password); // 第2引数を渡す
```

SG90 等のパルス幅を明示すると安定する場合がある：

```cpp
// 例: 500–2400µs（サーボにより適正値が違う）
myServo.attach(servoPin, 500, 2400);
```

## 注意: SSID 表示の不一致について

HTML の表示テキストとシリアルの案内には `ESP32_ServoController` という文言が出る箇所がある一方、実際の AP SSID はコード上 `WIFI` になっている。迷ったら Wi‑Fi リストで見える SSID（`WIFI`）を信じれば OK。

統一したければ、以下を同じ文字列に合わせる：

- `const char* ap_ssid = "...";`（実際の SSID）
- HTML 内の案内テキスト（`htmlPage` 文字列）
- シリアルログの文言

## よくあるトラブルと対処

- アップロードが失敗する / 遅い

  - `platformio.ini` の `upload_speed` を設定（現在ファイルには `jupload_speed` と書かれてるので修正推奨）
  - 正しい COM ポートを選択。必要なら BOOT ボタンを押しながら接続

- SSID が見つからない

  - 電源を入れ直す。チャンネル干渉があり得る。別の場所で試す
  - シリアルモニタでブートログを確認（115200bps）

- `http://192.168.4.1` に開けない

  - 端末が本当に `WIFI` に接続できているか確認（モバイルデータを切ると安定）
  - 端末のプロキシや VPN を切る

- サーボがガクガク / リセットする
  - 外部 5V 電源を使い、ESP32 と GND を共通化
  - `attach` のパルス幅を調整

## 将来やりたいこと（メモ）

- 2 系統サーボ（舵とセール）対応、UI のチャンネル追加
- ステッピングモーターとジャイロセンサーを使用しバランスを取れるようにする
- より簡単にアセンブリできるようにする

## フォルダ構成（抜粋）

- `CAD_Data/` … ヨットの 3D データ
- `Program_Data/` … ESP32/Arduino（PlatformIO）プロジェクト
- `Program_Data/src/main.cpp` … WebUI ＋サーボ制御本体
- `Program_Data/platformio.ini` … ビルド/ボード設定

— さあ、海風に乗せよう。コードはもう走る。あとは帆を張るだけだ。
